import { Component, OnInit, Inject } from '@angular/core';
import * as pdfjsLib from 'pdfjs-dist';
// import { version, PDFJSStatic, PDFDocumentProxy, PDFPromise } from 'pdfjs-dist';
import { DOCUMENT } from '@angular/common';
import * as $ from 'jquery';
var pdfjs = require('pdfjs-dist/web/pdf_viewer');
// var PDFAnnotate = require('pdfAnnot/pdfannotate');

import { ViewSDKClient } from '../shared/services/view-sdk.service';
import { AnnotService } from './annot.service';

// declare const fabric: any;

@Component({
  selector: 'app-test',
  templateUrl: './test.component.html',
  styleUrls: ['./test.component.scss']
})
export class TestComponent implements OnInit {
  document: Document;
  totalPages!: number;
  currPage!: number;
  pdfRef!: any;
  pdfURL: any = ''; cont: any = ''; auth: any = '';goTo:any=0;
  pdfFactory!: any;
  coordinates !: any;
  pdfViewer: any;
  doCircle!: boolean;
  otherPdfRef!:any;

  annotData!: any;

  constructor(
    @Inject(DOCUMENT) document: any,
    private viewSDKClient: ViewSDKClient,
    private annotServ: AnnotService
  ) {
    this.document = document;
    // const pdfWorkerSrc = `https://cdnjs.cloudflare.com/ajax/libs/pdf.js/${version}/pdf.worker.min.js`;
    const pdfWorkerSrc = 'assets/pdfjs/pdf.worker.min.js';
    pdfjsLib.GlobalWorkerOptions.workerSrc = pdfWorkerSrc;
  }

  ngOnInit(): void {
    // pdfjsLib.disableWorker = true; // due to CORS
    // pdfjsLib.PDFJS.disableWorker = true;
    // this.initializeState();
    this.annotList();
  }

  initializeState() {
    this.currPage = 1;
    this.totalPages = 0;
    this.pdfRef = null;
    this.pdfFactory = null;
    this.coordinates = [0, 0];
    this.doCircle = false;
  }

  //showPageControls,showDownloadPDF,showPrintPDF,showLeftHandPanel
  ngAfterViewInit() {
  }

  annotList(){
    this.annotData = [];
    this.annotServ.annotList({})
      .subscribe((data: any) => {
        if (data && Array.isArray(data.result) && data.result.length > 0) {
          for(let i=0;i<data.result.length;i++){
            this.annotData.push(JSON.parse(data.result[i].annotationData));
          }
          // console.log(this.annotData);
        } else {
        }
      }, (err: any) => {

      });
  }

  renderPDf2(){
    this.viewSDKClient.ready().then(() => {
      /* Invoke file preview */
      /* By default the embed mode will be Full Window */
      const canvas: any = this.document.querySelector('#pdf-div');
      canvas.style.display = "block";
      //   let data =
      //
      //   [{"@context":["https://www.w3.org/ns/anno.jsonld","https://comments.acrobat.com/ns/anno.jsonld"],"id":"b991899d-02fa-805a-81h5-08cb3b8d882","type":"Annotation","motivation":"commenting","bodyValue":"","target":{"source":"abc","selector":{"node":{"index":0},"opacity":0.4,"subtype":"shape","boundingBox":[492.39999771118164,518.5999984741211,545.3999977111816,604.5999984741211],"inkList":[[539.3999977111816,598.5999984741211,539.3999977111816,597.5999984741211,538.3999977111816,596.5999984741211,536.3999977111816,593.5999984741211,534.3999977111816,591.5999984741211,530.3999977111816,589.5999984741211,526.3999977111816,586.5999984741211,523.3999977111816,585.5999984741211,519.3999977111816,582.5999984741211,517.3999977111816,580.5999984741211,514.3999977111816,578.5999984741211,513.3999977111816,577.5999984741211,511.39999771118164,576.5999984741211,510.39999771118164,573.5999984741211,508.39999771118164,570.5999984741211,506.39999771118164,568.5999984741211,505.39999771118164,564.5999984741211,502.39999771118164,559.5999984741211,501.39999771118164,557.5999984741211,499.39999771118164,554.5999984741211,498.39999771118164,552.5999984741211,498.39999771118164,548.5999984741211,498.39999771118164,546.5999984741211,498.39999771118164,544.5999984741211,498.39999771118164,543.5999984741211,498.39999771118164,540.5999984741211,498.39999771118164,539.5999984741211,500.39999771118164,536.5999984741211,502.39999771118164,532.5999984741211,504.39999771118164,529.5999984741211,506.39999771118164,527.5999984741211,507.39999771118164,525.5999984741211,507.39999771118164,524.5999984741211,510.39999771118164,524.5999984741211,513.3999977111816,524.5999984741211,514.3999977111816,524.5999984741211,514.3999977111816,524.5999984741211,514.3999977111816,525.5999984741211,514.3999977111816,527.5999984741211,514.3999977111816,530.5999984741211,514.3999977111816,534.5999984741211,514.3999977111816,538.5999984741211,518.3999977111816,544.5999984741211,520.3999977111816,548.5999984741211,521.3999977111816,549.5999984741211,521.3999977111816,550.5999984741211]],"strokeColor":"#000000","strokeWidth":3,"type":"AdobeAnnoSelector"}},"creator":{"name":"Guest","type":"Person"},"created":"2020-10-23T18:05:19Z","modified":"2020-10-23T18:05:19Z"},
      //   {"@context":["https://www.w3.org/ns/anno.jsonld","https://comments.acrobat.com/ns/anno.jsonld"],"id":"3cb69628-3ad9-8b07-a8h5-fa8a3a8faa7","type":"Annotation","motivation":"commenting","bodyValue":"","target":{"source":"abc","selector":{"node":{"index":0},"opacity":0.4,"subtype":"shape","boundingBox":[64.39999771118164,521.8000030517578,414.39999771118164,598.8000030517578],"inkList":[[408.39999771118164,567.8000030517578,408.39999771118164,567.8000030517578,404.39999771118164,567.8000030517578,398.39999771118164,567.8000030517578,388.39999771118164,567.8000030517578,379.39999771118164,567.8000030517578,367.39999771118164,567.8000030517578,355.39999771118164,567.8000030517578,343.39999771118164,567.8000030517578,329.39999771118164,567.8000030517578,318.39999771118164,567.8000030517578,305.39999771118164,567.8000030517578,289.39999771118164,566.8000030517578,283.39999771118164,565.8000030517578,280.39999771118164,564.8000030517578,279.39999771118164,564.8000030517578,278.39999771118164,564.8000030517578,278.39999771118164,563.8000030517578,277.39999771118164,563.8000030517578,276.39999771118164,562.8000030517578,274.39999771118164,561.8000030517578,272.39999771118164,561.8000030517578,271.39999771118164,561.8000030517578,269.39999771118164,560.8000030517578,268.39999771118164,560.8000030517578,267.39999771118164,560.8000030517578,264.39999771118164,560.8000030517578,254.39999771118164,560.8000030517578,253.39999771118164,560.8000030517578,251.39999771118164,560.8000030517578,250.39999771118164,560.8000030517578,248.39999771118164,560.8000030517578],[165.39999771118164,572.8000030517578,166.39999771118164,572.8000030517578,175.39999771118164,571.8000030517578,197.39999771118164,569.8000030517578,216.39999771118164,569.8000030517578,223.39999771118164,571.8000030517578,227.39999771118164,572.8000030517578,230.39999771118164,572.8000030517578],[152.39999771118164,539.8000030517578,157.39999771118164,540.8000030517578,164.39999771118164,544.8000030517578,169.39999771118164,547.8000030517578,173.39999771118164,549.8000030517578,178.39999771118164,551.8000030517578,179.39999771118164,552.8000030517578,180.39999771118164,553.8000030517578,181.39999771118164,554.8000030517578,178.39999771118164,555.8000030517578,176.39999771118164,555.8000030517578,173.39999771118164,556.8000030517578,172.39999771118164,556.8000030517578,170.39999771118164,557.8000030517578,168.39999771118164,557.8000030517578,167.39999771118164,557.8000030517578,166.39999771118164,557.8000030517578,165.39999771118164,557.8000030517578,164.39999771118164,557.8000030517578,162.39999771118164,556.8000030517578,162.39999771118164,555.8000030517578,162.39999771118164,552.8000030517578,162.39999771118164,551.8000030517578,162.39999771118164,549.8000030517578,162.39999771118164,547.8000030517578,162.39999771118164,546.8000030517578,164.39999771118164,543.8000030517578,169.39999771118164,539.8000030517578,178.39999771118164,536.8000030517578,186.39999771118164,534.8000030517578,193.39999771118164,533.8000030517578,203.39999771118164,533.8000030517578,213.39999771118164,533.8000030517578,221.39999771118164,533.8000030517578,226.39999771118164,536.8000030517578,228.39999771118164,538.8000030517578,231.39999771118164,540.8000030517578,233.39999771118164,543.8000030517578,234.39999771118164,547.8000030517578,236.39999771118164,552.8000030517578,237.39999771118164,555.8000030517578,237.39999771118164,559.8000030517578,237.39999771118164,560.8000030517578,237.39999771118164,561.8000030517578,237.39999771118164,563.8000030517578,237.39999771118164,565.8000030517578,235.39999771118164,567.8000030517578,234.39999771118164,567.8000030517578,231.39999771118164,569.8000030517578,230.39999771118164,569.8000030517578,226.39999771118164,569.8000030517578,223.39999771118164,569.8000030517578,218.39999771118164,569.8000030517578,213.39999771118164,569.8000030517578,207.39999771118164,569.8000030517578,201.39999771118164,569.8000030517578,191.39999771118164,566.8000030517578,182.39999771118164,564.8000030517578,175.39999771118164,560.8000030517578,170.39999771118164,559.8000030517578,167.39999771118164,556.8000030517578,167.39999771118164,555.8000030517578,167.39999771118164,555.8000030517578,167.39999771118164,554.8000030517578,167.39999771118164,552.8000030517578,168.39999771118164,552.8000030517578,171.39999771118164,551.8000030517578,176.39999771118164,551.8000030517578,180.39999771118164,551.8000030517578,184.39999771118164,551.8000030517578,189.39999771118164,553.8000030517578,190.39999771118164,555.8000030517578,191.39999771118164,557.8000030517578,192.39999771118164,559.8000030517578,192.39999771118164,562.8000030517578,192.39999771118164,565.8000030517578,191.39999771118164,567.8000030517578,190.39999771118164,569.8000030517578,190.39999771118164,570.8000030517578,188.39999771118164,572.8000030517578,186.39999771118164,573.8000030517578,186.39999771118164,574.8000030517578,184.39999771118164,575.8000030517578,182.39999771118164,576.8000030517578,166.39999771118164,579.8000030517578,128.39999771118164,585.8000030517578,115.39999771118164,587.8000030517578,102.39999771118164,587.8000030517578,93.39999771118164,587.8000030517578,85.39999771118164,587.8000030517578,80.39999771118164,587.8000030517578,80.39999771118164,586.8000030517578,80.39999771118164,586.8000030517578,80.39999771118164,584.8000030517578,80.39999771118164,583.8000030517578,81.39999771118164,583.8000030517578,82.39999771118164,583.8000030517578,84.39999771118164,583.8000030517578,87.39999771118164,582.8000030517578,90.39999771118164,582.8000030517578,91.39999771118164,582.8000030517578,94.39999771118164,582.8000030517578,96.39999771118164,583.8000030517578,97.39999771118164,584.8000030517578,97.39999771118164,587.8000030517578,98.39999771118164,590.8000030517578,98.39999771118164,591.8000030517578,98.39999771118164,592.8000030517578,95.39999771118164,592.8000030517578,94.39999771118164,592.8000030517578,92.39999771118164,592.8000030517578,89.39999771118164,592.8000030517578,87.39999771118164,591.8000030517578,82.39999771118164,586.8000030517578,80.39999771118164,581.8000030517578,78.39999771118164,580.8000030517578,78.39999771118164,578.8000030517578,78.39999771118164,577.8000030517578,78.39999771118164,575.8000030517578,78.39999771118164,574.8000030517578,79.39999771118164,573.8000030517578,82.39999771118164,572.8000030517578,88.39999771118164,569.8000030517578,94.39999771118164,567.8000030517578,101.39999771118164,565.8000030517578,106.39999771118164,564.8000030517578,112.39999771118164,564.8000030517578,114.39999771118164,564.8000030517578,118.39999771118164,564.8000030517578,118.39999771118164,564.8000030517578,119.39999771118164,564.8000030517578,119.39999771118164,565.8000030517578,119.39999771118164,567.8000030517578,117.39999771118164,575.8000030517578,114.39999771118164,579.8000030517578,114.39999771118164,579.8000030517578,112.39999771118164,581.8000030517578,110.39999771118164,583.8000030517578,108.39999771118164,583.8000030517578,104.39999771118164,583.8000030517578,90.39999771118164,583.8000030517578,81.39999771118164,580.8000030517578,76.39999771118164,577.8000030517578,74.39999771118164,573.8000030517578,72.39999771118164,569.8000030517578,70.39999771118164,564.8000030517578,70.39999771118164,562.8000030517578,70.39999771118164,560.8000030517578,70.39999771118164,559.8000030517578,70.39999771118164,557.8000030517578,72.39999771118164,554.8000030517578,72.39999771118164,553.8000030517578,76.39999771118164,551.8000030517578,81.39999771118164,548.8000030517578,85.39999771118164,547.8000030517578,90.39999771118164,546.8000030517578,95.39999771118164,545.8000030517578,102.39999771118164,545.8000030517578,107.39999771118164,545.8000030517578,112.39999771118164,545.8000030517578,117.39999771118164,550.8000030517578,122.39999771118164,559.8000030517578,126.39999771118164,567.8000030517578,128.39999771118164,574.8000030517578,130.39999771118164,582.8000030517578,130.39999771118164,585.8000030517578,130.39999771118164,587.8000030517578,130.39999771118164,588.8000030517578,130.39999771118164,589.8000030517578,130.39999771118164,590.8000030517578,130.39999771118164,591.8000030517578,130.39999771118164,591.8000030517578,128.39999771118164,591.8000030517578,125.39999771118164,591.8000030517578,121.39999771118164,591.8000030517578,115.39999771118164,591.8000030517578,110.39999771118164,587.8000030517578,102.39999771118164,582.8000030517578,96.39999771118164,575.8000030517578,90.39999771118164,571.8000030517578,85.39999771118164,565.8000030517578,81.39999771118164,558.8000030517578,79.39999771118164,557.8000030517578,78.39999771118164,554.8000030517578,78.39999771118164,553.8000030517578,78.39999771118164,551.8000030517578,78.39999771118164,550.8000030517578,78.39999771118164,547.8000030517578,78.39999771118164,544.8000030517578,82.39999771118164,541.8000030517578,90.39999771118164,535.8000030517578,95.39999771118164,533.8000030517578,104.39999771118164,531.8000030517578,112.39999771118164,528.8000030517578,116.39999771118164,527.8000030517578,121.39999771118164,527.8000030517578,122.39999771118164,527.8000030517578,126.39999771118164,537.8000030517578,130.39999771118164,543.8000030517578,130.39999771118164,547.8000030517578,130.39999771118164,552.8000030517578,130.39999771118164,555.8000030517578,130.39999771118164,558.8000030517578,130.39999771118164,559.8000030517578]],"strokeColor":"#000000","strokeWidth":3,"type":"AdobeAnnoSelector"}},"creator":{"name":"Guest","type":"Person"},"created":"2020-10-23T18:23:45Z","modified":"2020-10-23T18:23:45Z"},
      //
      //
      //
      //   {"@context":["https://www.w3.org/ns/anno.jsonld","https://comments.acrobat.com/ns/anno.jsonld"],"id":"dea79a5f-ef7b-8e59-26he-29982a9ba94","type":"Annotation","motivation":"commenting","bodyValue":"","target":{"source":"abc","selector":{"node":{"index":2},"opacity":0.4,"subtype":"shape","boundingBox":[256.39999771118164,435.3999938964844,467.39999771118164,514.3999938964844],"inkList":[[461.39999771118164,483.3999938964844,458.39999771118164,483.3999938964844,457.39999771118164,483.3999938964844,454.39999771118164,483.3999938964844,450.39999771118164,483.3999938964844,442.39999771118164,483.3999938964844,431.39999771118164,483.3999938964844,419.39999771118164,483.3999938964844,391.39999771118164,483.3999938964844,365.39999771118164,480.3999938964844,354.39999771118164,479.3999938964844,346.39999771118164,476.3999938964844,342.39999771118164,475.3999938964844,342.39999771118164,475.3999938964844,340.39999771118164,475.3999938964844,340.39999771118164,474.3999938964844,340.39999771118164,473.3999938964844,340.39999771118164,471.3999938964844,340.39999771118164,470.3999938964844,340.39999771118164,468.3999938964844,340.39999771118164,467.3999938964844,340.39999771118164,466.3999938964844,340.39999771118164,465.3999938964844,342.39999771118164,463.3999938964844,348.39999771118164,459.3999938964844,352.39999771118164,458.3999938964844,358.39999771118164,457.3999938964844,364.39999771118164,455.3999938964844,368.39999771118164,454.3999938964844,372.39999771118164,454.3999938964844,375.39999771118164,454.3999938964844,378.39999771118164,454.3999938964844,379.39999771118164,454.3999938964844,382.39999771118164,454.3999938964844,383.39999771118164,455.3999938964844,383.39999771118164,455.3999938964844,383.39999771118164,457.3999938964844,383.39999771118164,459.3999938964844,383.39999771118164,460.3999938964844,383.39999771118164,462.3999938964844,382.39999771118164,464.3999938964844,379.39999771118164,466.3999938964844,377.39999771118164,467.3999938964844,373.39999771118164,468.3999938964844,370.39999771118164,468.3999938964844,366.39999771118164,469.3999938964844,362.39999771118164,469.3999938964844,352.39999771118164,470.3999938964844,351.39999771118164,470.3999938964844,350.39999771118164,470.3999938964844,349.39999771118164,470.3999938964844,348.39999771118164,470.3999938964844,347.39999771118164,470.3999938964844,346.39999771118164,468.3999938964844,346.39999771118164,466.3999938964844,346.39999771118164,465.3999938964844,346.39999771118164,463.3999938964844,346.39999771118164,462.3999938964844,346.39999771118164,460.3999938964844,347.39999771118164,459.3999938964844,349.39999771118164,458.3999938964844,352.39999771118164,457.3999938964844,353.39999771118164,456.3999938964844,354.39999771118164,456.3999938964844,355.39999771118164,456.3999938964844,355.39999771118164,457.3999938964844,353.39999771118164,459.3999938964844,350.39999771118164,461.3999938964844,342.39999771118164,465.3999938964844,333.39999771118164,471.3999938964844,320.39999771118164,474.3999938964844,308.39999771118164,475.3999938964844,298.39999771118164,476.3999938964844,287.39999771118164,476.3999938964844,279.39999771118164,476.3999938964844,272.39999771118164,476.3999938964844,266.39999771118164,475.3999938964844,263.39999771118164,473.3999938964844,262.39999771118164,472.3999938964844,262.39999771118164,471.3999938964844,262.39999771118164,470.3999938964844,263.39999771118164,467.3999938964844,266.39999771118164,465.3999938964844,270.39999771118164,461.3999938964844,274.39999771118164,457.3999938964844,282.39999771118164,452.3999938964844,290.39999771118164,447.3999938964844,297.39999771118164,443.3999938964844,299.39999771118164,443.3999938964844,302.39999771118164,442.3999938964844,305.39999771118164,441.3999938964844,307.39999771118164,442.3999938964844,310.39999771118164,446.3999938964844,310.39999771118164,449.3999938964844,311.39999771118164,452.3999938964844,311.39999771118164,458.3999938964844,311.39999771118164,459.3999938964844,311.39999771118164,460.3999938964844,311.39999771118164,461.3999938964844,310.39999771118164,463.3999938964844,309.39999771118164,464.3999938964844,306.39999771118164,466.3999938964844,302.39999771118164,467.3999938964844,298.39999771118164,467.3999938964844,294.39999771118164,469.3999938964844,289.39999771118164,470.3999938964844,286.39999771118164,470.3999938964844,284.39999771118164,470.3999938964844,282.39999771118164,470.3999938964844,281.39999771118164,470.3999938964844,278.39999771118164,470.3999938964844,278.39999771118164,470.3999938964844,274.39999771118164,469.3999938964844,274.39999771118164,467.3999938964844,274.39999771118164,467.3999938964844,274.39999771118164,466.3999938964844,274.39999771118164,463.3999938964844,275.39999771118164,462.3999938964844,278.39999771118164,461.3999938964844,281.39999771118164,459.3999938964844,285.39999771118164,458.3999938964844,292.39999771118164,457.3999938964844,298.39999771118164,457.3999938964844,304.39999771118164,457.3999938964844,311.39999771118164,460.3999938964844,318.39999771118164,464.3999938964844,322.39999771118164,469.3999938964844,324.39999771118164,474.3999938964844,328.39999771118164,481.3999938964844,328.39999771118164,485.3999938964844,329.39999771118164,487.3999938964844,329.39999771118164,489.3999938964844,330.39999771118164,491.3999938964844,330.39999771118164,491.3999938964844,333.39999771118164,491.3999938964844,346.39999771118164,495.3999938964844,356.39999771118164,498.3999938964844,368.39999771118164,502.3999938964844,381.39999771118164,505.3999938964844,391.39999771118164,507.3999938964844,399.39999771118164,508.3999938964844,406.39999771118164,508.3999938964844,410.39999771118164,508.3999938964844,413.39999771118164,508.3999938964844,414.39999771118164,508.3999938964844,414.39999771118164,508.3999938964844,415.39999771118164,508.3999938964844,415.39999771118164,507.3999938964844,416.39999771118164,507.3999938964844,416.39999771118164,505.3999938964844,418.39999771118164,503.3999938964844,418.39999771118164,503.3999938964844,418.39999771118164,503.3999938964844,420.39999771118164,502.3999938964844,421.39999771118164,502.3999938964844,422.39999771118164,502.3999938964844,423.39999771118164,502.3999938964844,424.39999771118164,502.3999938964844]],"strokeColor":"#000000","strokeWidth":3,"type":"AdobeAnnoSelector"}},"creator":{"name":"Guest","type":"Person"},"created":"2020-10-23T18:25:03Z","modified":"2020-10-23T18:25:03Z"}
      //
      //
      //
      // ];
      let data = {
        defConfg: {
          enableAnnotationAPIs: true,showDownloadPDF: false,
          showLeftHandPanel:false,showPrintPDF: false,
          // includePDFAnnotations:true // for the save button
          // ,showAnnotationTools: true,
          // defaultViewMode: "FIT_WIDTH",showPageControls:true,
        },
        name: 'my file',
        divId: 'pdf-div',
        url: this.pdfURL
      }
      this.viewSDKClient.previewFile(data,this.annotData);
    });
  }

  clearPdfRef() {
    if (this.pdfRef) {
      this.pdfRef.cleanup();
      this.pdfRef.destroy();
    }
  }

  gotoPage(){
    this.viewSDKClient.goToPage(parseInt(this.goTo))
  }

  pdfRender() {
    this.initializeState();
    const loadingTask = pdfjsLib.getDocument({
      url: "https://mozilla.github.io/pdf.js/web/compressed.tracemonkey-pldi-09.pdf",
      // httpHeaders: { Authorization: `Bearer ds}` },
      // withCredentials: true,
    });
    loadingTask.promise.then((pdfDocument: any) => {
      // Document loaded, retrieving the page.
      this.pdfRef = pdfDocument;
      this.totalPages = pdfDocument.numPages;
      console.log(pdfDocument.numPages, "pdf.numPages;")
      pdfDocument.getPage(1).then(this.handlePages);
    });
  }

  getPageID(type='page') {
    return type+"-d-" + (this.currPage - 1);
  }

  handlePages = (page: any) => {
    const scale = 1.0;
    console.log(page, "page")
    let pageId: any = this.getPageID();
    let viewport = page.getViewport({scale});
    // const container: any = this.document.querySelector('#' + pageId);
    // container.style.display = "block";
    const canvas: any = this.document.querySelector('#' + this.getPageID('canv'));
    canvas.style.display = "block";
    // const pdfPageView = new pdfjs.PDFPageView({
    //   container: container,
    //   id: this.currPage,
    //   scale,
    //   defaultViewport: page.getViewport({ scale }),
    //   // Enable text/annotations layers, if needed
    //   textLayerFactory: new pdfjs.DefaultTextLayerFactory(),
    //   annotationLayerFactory: new pdfjs.DefaultAnnotationLayerFactory(),
    // });
    // // Associates the actual page with the view, and drawing it
    // pdfPageView.setPdfPage(page);
    // pdfPageView.draw();
    var context = canvas.getContext('2d');
    canvas.height = viewport.height;
    canvas.width = viewport.width;
    page.render({canvasContext: context, viewport: viewport})
    .then( ()=> {

    })
    // const scale = 1;
    // console.log(page, "page")
    // let pageId: any = this.getPageID();
    // var viewport = page.getViewport({scale});
    // var canvas:any = this.document.getElementById("canvas-id");
    // var context = canvas.getContext('2d');
    // canvas.height = viewport.height;
    // canvas.width = viewport.width;
    // // Render PDF page into canvas context
    //  var renderContext = {
    //      canvasContext: context,
    //      viewport: viewport
    //  };
    // var renderTask = page.render(renderContext);
    //              renderTask.promise.then(function () {
    //                  console.log('Page rendered');
    //                  //Now you can draw new rectangle
    //                  context.strokeStyle = "red";
    //                  context.strokeRect(10, 10, 100, 50);
    //              })
    // page.render({
    //   canvasContext: context,
    //   viewport: viewport
    // }).then(function() {
    //   var bg = canvas.toDataURL("image/png");
    //   var fcanvas = new fabric.Canvas("pdfcanvas", {
    //     selection: false
    //   });
    //   fcanvas.setBackgroundImage(bg,fcanvas.renderAll.bind(fcanvas));
    //       fcanvas.setWidth(300);
    //       fcanvas.setHeight(300);
    //       var rect = new fabric.Rect({
    //         left: 100,
    //         top: 100,
    //         width: 50,
    //         height: 50,
    //         fill: '#FF454F',
    //         opacity: 0.5,
    //         transparentCorners: true,
    //         borderColor: "gray",
    //         cornerColor: "gray",
    //         cornerSize: 5
    //       });
    //       fcanvas.add(rect);
    //       fcanvas.renderAll();
    //   });

  }

  getPage(type: string) {
    if (this.currPage && this.pdfRef) {
      if (type === 'prev')
        this.currPage--;
      else
        this.currPage++;
      var node: any = this.document.getElementById(this.getPageID());
      if (node.hasChildNodes()) {
        // It has at least one
        // this.document.getElementById(this.getPageID())!.scrollIntoView({behavior: 'smooth'});
      } else {
        this.pdfRef.getPage(this.currPage).then(this.handlePages);
      }
    }
  }

  counter(i: number) {
    return new Array(i);
  }

}
