<app-loader [type]="'page'" *ngIf="loading"></app-loader> <!-- loader -->

<div class="tags-page row mx-0" *ngIf="!loading">
  <div [ngClass]="{'sub-tab-nav row mx-0 mt-4 px-0': true, 'col-md-12': !showRowInfo, 'col-md-8': showRowInfo}">
    <div class="col" style="min-width: 240px; max-width: 240px;">
      <div class="card bg-hi-grey" style="min-height:100% !important;">
        <div class="card-body">
          <div class="text-hi-dark-grey">Tags</div>
          <ul class="list-unstyled ml-2 mt-1">
            <li class="dark-bg-hover px-2 py-1 rounded mt-2" [ngClass]="{'act-tag': selTag==='all'}"
              (click)="changeTag('all')">All tags</li>
            <li class="dark-bg-hover px-2 py-1 rounded mt-2" [ngClass]="{'act-tag': selTag==='uncatg'}"
              (click)="changeTag('uncatg')">
              Uncategorized Tags
            </li>
          </ul>
          <hr>
          <div class="text-hi-dark-grey">
            Categories
            <div class="float-right btn p-0" (click)="toggleCatgInp()"><i class="fa fa-plus-circle text-primary"></i>
            </div>
            <form name="catgForm" (ngSubmit)="addCatg()" [formGroup]="catgForm" novalidate *ngIf="showCatgIn">
              <mat-form-field appearance="outline" class="custom-mat-input sp-mat-input w-100 my-2 flex bg-white"
                [floatLabel]="'never'">
                <input matInput placeholder="Add Category" class="ml-0" formControlName="name" required>
                <div matSuffix>
                  <button type="submit" class="btn btn-secondary input-btn mr-1" (click)="toggleCatgInp()">
                    <i class="fas fa-times"></i>
                  </button>
                  <button type="submit" class="btn btn-primary input-btn"
                    [disabled]="catgForm!.invalid || catgAddDisabled">
                    <app-loader [type]="'btn'" *ngIf="catgAddDisabled" class="align-spin-top"></app-loader>
                    <i class="fas fa-check-circle" *ngIf="!catgAddDisabled"></i>
                  </button>
                </div>
                <mat-error *ngIf="catgForm.get('name')!.hasError('required')" class="mt-3">
                  Name is required
                </mat-error>
              </mat-form-field>
            </form>
          </div>
          <ul class="list-unstyled ml-2 mt-1 cat-list" *ngIf="catgs.length>0 else noCatg">
            <li class="dark-bg-hover px-2 py-1 rounded mt-2" *ngFor="let catg of catgs">
              {{catg.name}}
              <div class="float-right row mx-0">
                <i class="fa fa-plus-circle align-self-center text-primary mr-2" (click)="showCatListIP($event)"></i>
                <div class="dropdown">
                  <div class="dropdown-toggle disable-icon" type="button" id="catEllipsis" data-toggle="dropdown"
                    aria-haspopup="true" aria-expanded="false">
                    <i class="fa fa-ellipsis-h"></i>
                  </div>
                  <div class="dropdown-menu" aria-labelledby="catEllipsis">
                    <a class="dropdown-item" (click)="updCatgModal(editCategory, catg)">
                      <i class="fas fa-edit mr-1"></i>Edit
                    </a>
                    <a class="dropdown-item" (click)="delCatg({})">
                      <i class="fas fa-trash-alt mr-1"></i>Delete
                    </a>
                  </div>
                </div>
              </div>
              <mat-form-field appearance="outline" class="custom-mat-input w-100 my-2 flex bg-white"
                [floatLabel]="'never'" style="display: none;">
                <input matInput placeholder="Add Category" class="ml-0">
                <div matSuffix class="curs-ptr">
                  <i class="fas fa-times mr-2" (click)="closeCatListIP($event)"></i>
                  <i class="fas fa-check-circle text-primary" (click)="closeCatListIP($event)"></i>
                </div>
              </mat-form-field>
            </li>
          </ul>
          <ng-template #noCatg>
            <div class="text-secondary text-center mt-2">
              No catgories found
            </div>
          </ng-template>
        </div>
      </div>
    </div>
    <div class="col">
      <div class="card overflow-hidden w-100">
        <div class="card-body rounded-bottom px-0 pb-0">
          <h5 class="card-title px-3">
            <div class="heading">
              <mat-form-field appearance="outline" class="custom-mat-input float-right mb-3" [floatLabel]="'never'"
                style="min-width: 300px;">
                <i matPrefix class="fa fa-search text-secondary"></i>
                <input matInput placeholder="Search Tag ..." class="ml-0" #sear [(ngModel)]="searchTxt">
              </mat-form-field>
              <div class="search" *ngIf="tagForm">
                <form name="tagForm" (ngSubmit)="addTags()" [formGroup]="tagForm" novalidate>
                  <mat-form-field class="custom-mat-input mb-2" appearance="outline" style="width:85%;"
                    [floatLabel]="'never'">
                    <mat-chip-list #tagList aria-label="tag selection" formControlName="name">
                      <mat-chip *ngFor="let tag of tagNames" selectable removable (removed)="removeChip(tag)">
                        {{tag}}
                        <i class="fa fa-times" matChipRemove></i>
                      </mat-chip>
                      <input placeholder="Add Tags (Separate tags by comma or enter)" [matChipInputFor]="tagList"
                        [matChipInputSeparatorKeyCodes]="separatorKeysCodes" matChipInputAddOnBlur
                        (matChipInputTokenEnd)="addChips($event)" formControlName="name">
                    </mat-chip-list>
                  </mat-form-field>
                  <button type="submit" class="btn btn-primary ml-3" [disabled]="tagForm!.invalid || tagAddDisabled">
                    <app-loader [type]="'btn'" *ngIf="tagAddDisabled"></app-loader>
                    Create
                  </button>
                </form>
              </div>
            </div>
          </h5>
          <div class="card-text px-3">
            <app-loader [type]="'page'" *ngIf="tagLoading"></app-loader> <!-- loader -->
            <table [ngClass]="{'table table-hover text-dark w-100': true, 'hide-rows': showRowInfo}"
              *ngIf="!tagLoading">
              <thead>
                <tr>
                  <th scope="col" class="curs-ptr">Name<i class="fas fa-sort-down ml-1 align-top"></i>
                  </th>
                  <th scope="col" class="curs-ptr">Status<i class="fas fa-sort-down ml-1 align-top"></i>
                  </th>
                  <th scope="col" class="curs-ptr">Date Modified<i class="fas fa-sort-down ml-1 align-top"></i></th>
                </tr>
              </thead>
              <tbody>
                <tr (click)="toggleInfo(tag)" *ngFor="let tag of tags">
                  <td>
                    {{tag.name}}
                  </td>
                  <td class="text-hi-dark-grey">No Status</td>
                  <td>No Date</td>
                </tr>
              </tbody>
            </table>
          </div>
          <div class="card-footer row justify-content-between mx-0">
            <div class="pages">
              <mat-form-field appearance="outline" class="mr-2">
                <mat-select [(ngModel)]="pageSize" (selectionChange)="pageSizeChange()">
                  <mat-option value="10">10</mat-option>
                  <mat-option value="20">20</mat-option>
                  <mat-option value="50">50</mat-option>
                  <mat-option value="100">100</mat-option>
                </mat-select>
              </mat-form-field>
              <!-- <span>Showing 1-10 of {{numAllTags}}</span> -->
            </div>
            <ul class="pagination">
              <li class="page-item disabled">
                <a class="page-link bg-hi-grey" href="javascript:void(0)" tabindex="-1" aria-disabled="true"><i
                    class="fas fa-chevron-left"></i></a>
              </li>
              <!-- <li class="page-item" *ngFor="let item of [].constructor(paginationNum); let i = index">
                <a class="page-link bg-hi-grey" href="javascript:void(0)">{{i+1}}</a>
              </li> -->
              <li class="page-item">
                <a class="page-link bg-hi-grey" href="javascript:void(0)"><i class="fas fa-chevron-right"></i></a>
              </li>
            </ul>
          </div>
        </div>
      </div>
    </div>
  </div>
  <div class="workspace w-100 col-md-4 mt-4" *ngIf="showRowInfo">
    <div class="document">
      <div class="card">
        <div class="card-header row m-0">
          <h5 class="mb-0 pt-1 col-10 pl-0 align-self-center">Group Stock Position</h5>
          <div class="mr-2 col-1 ml-auto">
            <div class="btn btn-light" (click)="closeInfo()">
              <i class="fas fa-times"></i>
            </div>
          </div>
        </div>
        <div class="card-body">
          <div class="doc-details details border-bottom mb-3 pb-3">
            <div class="name">
              <label class="text-hi-dark-grey mb-0 mt-2">Details</label>
              <div class="value">
                3C Metal ABC
              </div>
            </div>
            <div class="orgCategories">
              <label class="text-hi-dark-grey mb-0 mt-2">Organisation in Categories</label>
              <div class="value">
                No Catgories
              </div>
            </div>
            <div class="usedIn">
              <label class="text-hi-dark-grey mb-0 mt-2">Used In</label>
              <div class="value">
                1 saved filter
              </div>
            </div>
          </div>
          <div class="doc-details status">
            <div class="heading text-hi-dark-grey font-weight-bold">Status</div>
            <div class="created">
              <label class="text-hi-dark-grey mb-0 mt-2">Date Created</label>
              <div class="value">
                15 Oct 2019, 17:55
              </div>
            </div>
            <div class="updated">
              <label class="text-hi-dark-grey mb-0 mt-2">Date Updated</label>
              <div class="value">
                15 Oct 2019, 17:55
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>

<!-- edit category modal  -->
<ng-template #editCategory let-modal>
  <div class="modal-header">
    <h4 class="modal-title" id="modal-basic-title">Edit Category</h4>
    <button type="button" class="close" aria-label="Close" (click)="modal.dismiss('Cross click')">
      <span aria-hidden="true">&times;</span>
    </button>
  </div>
  <form name="catgForm" (ngSubmit)="updCatg()" [formGroup]="catgForm" novalidate>
    <div class="modal-body" ngbAutofocus>
      <mat-form-field appearance="outline" class="w-100">
        <mat-label>Name</mat-label>
        <input matInput type="text" placeholder="Name" formControlName="name" required>
        <mat-error *ngIf="catgForm.get('name')!.hasError('required')">
          Name is required
        </mat-error>
      </mat-form-field>
      <mat-label>Published</mat-label>
      <mat-checkbox class="d-block">Published</mat-checkbox>
      <p class="text-danger">
        When published, a tag category becomes available to users for filtering content based on tags (e.g. in
        advanced search). You can uncheck this option to prevent a tag category can be used for filtering. Tags that
        are part of an unpublished category will never be shown to users.
      </p>
    </div>
    <div class="modal-footer">
      <button type="submit" class="btn btn-primary" [disabled]="catgForm!.invalid || catgUpdDisabled">
        <app-loader [type]="'btn'" *ngIf="catgUpdDisabled"></app-loader>
        Save
      </button>
    </div>
  </form>
</ng-template>
